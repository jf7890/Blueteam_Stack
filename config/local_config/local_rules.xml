<group name="custom,web,fim,attack_chain,">

  <!-- ================= BASE WEB EVENT ================= -->

  <rule id="100000" level="2">
    <if_group>web</if_group>
    <description>Base web traffic detected</description>
  </rule>

  <!-- ================= SQL INJECTION ================= -->

  <rule id="100010" level="10">
    <if_sid>100000</if_sid>
    <field name="full_log">select</field>
    <description>Possible SQL Injection detected (keyword: SELECT)</description>
    <mitre>
      <id>T1190</id>
    </mitre>
  </rule>

  <rule id="100011" level="10">
    <if_sid>100000</if_sid>
    <field name="full_log">union</field>
    <description>Possible SQL Injection detected (keyword: UNION)</description>
    <mitre>
      <id>T1190</id>
    </mitre>
  </rule>

  <rule id="100012" level="12">
    <if_sid>100000</if_sid>
    <field name="full_log">information_schema</field>
    <description>SQL Injection database enumeration attempt</description>
    <mitre>
      <id>T1190</id>
    </mitre>
  </rule>

  <rule id="100013" level="12">
    <if_sid>100000</if_sid>
    <field name="full_log">--</field>
    <description>SQL Injection comment pattern detected</description>
    <mitre>
      <id>T1190</id>
    </mitre>
  </rule>

  <!-- ================= SQL SUCCESS ================= -->

  <rule id="100020" level="13">
    <if_sid>100010</if_sid>
    <field name="data.id">200</field>
    <description>SQL Injection successful (HTTP 200)</description>
  </rule>

  <!-- ================= BRUTE SQLI ================= -->

  <rule id="100030" level="15" frequency="3" timeframe="300">
    <if_matched_sid>100010</if_matched_sid>
    <same_field>data.srcip</same_field>
    <description>Multiple SQL Injection attempts from single IP</description>
  </rule>


  <!-- ================= FIM ================= -->

  <rule id="100100" level="8">
    <if_group>syscheck</if_group>
    <field name="syscheck.event">added</field>
    <description>File added to system</description>
  </rule>

  <rule id="100101" level="10">
    <if_sid>100100</if_sid>
    <field name="syscheck.path">/dvwa_upload/</field>
    <description>File uploaded to web directory</description>
    <mitre>
      <id>T1505</id>
    </mitre>
  </rule>

  <rule id="100102" level="13">
    <if_sid>100101</if_sid>
    <field name="syscheck.path">.php</field>
    <description>Webshell file detected (.php)</description>
    <mitre>
      <id>T1505</id>
    </mitre>
  </rule>

  <!-- ================= CORRELATION ================= -->

  <rule id="100200" level="15">
    <if_matched_sid>100010</if_matched_sid>
    <if_matched_sid>100101</if_matched_sid>
    <description>ATTACK CHAIN: SQL Injection followed by file upload</description>
    <mitre>
      <id>T1190</id>
      <id>T1505</id>
    </mitre>
  </rule>

</group>