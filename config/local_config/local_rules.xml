<group name="custom,web,fim,attack_chain,">

  <rule id="100000" level="2">
    <if_group>json</if_group>
    <field name="transaction.producer.modsecurity">.</field>
    <description>ModSecurity log detected</description>
  </rule>

  <rule id="100010" level="10">
    <if_sid>100000</if_sid>
    <field name="transaction.messages.details.ruleId">^942</field>
    <description>SQL Injection attempt detected (ModSecurity)</description>
    <mitre>
      <id>T1190</id>
    </mitre>
  </rule>

  <rule id="100011" level="3">
    <if_sid>100010</if_sid>
    <field name="transaction.response.http_code">403</field>
    <description>SQL Injection blocked by WAF</description>
  </rule>

  <rule id="100012" level="12">
    <if_sid>100010</if_sid>
    <field name="transaction.response.http_code">200</field>
    <description>WARNING: SQL Injection potentially successful (HTTP 200 returned)</description>
  </rule>

  <rule id="100100" level="5">
    <if_group>syscheck</if_group>
    <field name="syscheck.event">added</field>
    <description>File added to system</description>
  </rule>

  <rule id="100101" level="10">
    <if_sid>100100</if_sid>
    <field name="syscheck.path">/dvwa_upload/</field>
    <description>File uploaded to DVWA directory</description>
    <mitre>
      <id>T1505</id>
    </mitre>
  </rule>

  <rule id="100102" level="13">
    <if_sid>100101</if_sid>
    <field name="syscheck.path" type="pcre2">\.php$</field>
    <description>Webshell file detected (.php) in upload folder</description>
    <mitre>
      <id>T1505</id>
    </mitre>
  </rule>

  <rule id="100200" level="15">
    <if_sid>100101</if_sid> 
    
    <if_matched_sid>100010</if_matched_sid> 
    
    <timeframe>600</timeframe>
    
    <description>CRITICAL ATTACK CHAIN: SQL Injection followed by File Upload to DVWA</description>
    <mitre>
      <id>T1190</id>
      <id>T1505</id>
    </mitre>
  </rule>

</group>