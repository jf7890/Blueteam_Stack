<group name="custom,web,waf,fim,attack_chain,">

  <!-- ================= BASE WEB EVENT ================= -->

  <rule id="100000" level="2">
    <if_group>web</if_group>
    <description>Base web access log</description>
  </rule>

  <!-- ================= SQL INJECTION ================= -->

  <rule id="100010" level="10">
    <if_sid>100000</if_sid>
    <regex>union|select|information_schema|sleep\(|benchmark\(|--|%</regex>
    <description>SQL Injection attempt detected</description>
    <mitre>
      <id>T1190</id>
    </mitre>
  </rule>

  <rule id="100011" level="12">
    <if_sid>100010</if_sid>
    <field name="data.id">200</field>
    <description>SQL Injection success (HTTP 200)</description>
  </rule>

  <rule id="100012" level="15" frequency="3" timeframe="300">
    <if_matched_sid>100010</if_matched_sid>
    <same_field>data.srcip</same_field>
    <description>Multiple SQL injection attempts from one IP</description>
  </rule>

  <!-- ================= FIM: FILE UPLOAD ================= -->

  <rule id="100100" level="8">
    <if_group>syscheck</if_group>
    <field name="syscheck.event">added</field>
    <description>File added to monitored directory</description>
  </rule>

  <rule id="100101" level="10">
    <if_sid>100100</if_sid>
    <regex>/dvwa_upload/|/uploads/|/html/</regex>
    <description>File added in web directory</description>
  </rule>

  <rule id="100102" level="13">
    <if_sid>100101</if_sid>
    <regex>\.php$|\.jsp$|\.asp$|\.aspx$|\.sh$|\.py$</regex>
    <description>Webshell extension detected</description>
    <mitre>
      <id>T1505</id>
    </mitre>
  </rule>

  <!-- ================= CORRELATION ================= -->

  <rule id="100200" level="15">
    <if_matched_sid>100010</if_matched_sid>
    <if_matched_sid>100101</if_matched_sid>
    <description>Attack chain: SQLi followed by file upload</description>
    <mitre>
      <id>T1190</id>
      <id>T1505</id>
    </mitre>
  </rule>

</group>
