<group name="web,modsecurity,fim">

  <!-- ================================================= -->
  <!-- BASE RULE FOR MODSECURITY -->
  <!-- ================================================= -->

  <rule id="100000" level="2">
    <if_group>json</if_group>
    <field name="transaction.producer.modsecurity">.</field>
    <description>ModSecurity log detected</description>
  </rule>


  <!-- ================================================= -->
  <!-- SQL INJECTION -->
  <!-- ================================================= -->

  <rule id="100010" level="10">
    <if_sid>100000</if_sid>
    <regex>942100|attack-sqli|SQL Injection</regex>
    <description>SQL Injection attempt detected by ModSecurity</description>
    <mitre>
      <id>T1190</id>
    </mitre>
  </rule>


  <!-- ================================================= -->
  <!-- BLOCKED REQUEST -->
  <!-- ================================================= -->

  <rule id="100020" level="8">
    <if_sid>100000</if_sid>
    <field name="transaction.response.http_code">^403$</field>
    <description>Request blocked by WAF</description>
  </rule>


  <!-- ================================================= -->
  <!-- SQLI BLOCKED -->
  <!-- ================================================= -->

  <rule id="100021" level="12">
    <if_sid>100010</if_sid>
    <field name="transaction.response.http_code">^403$</field>
    <description>SQL Injection blocked by WAF from $(transaction.client_ip)</description>
  </rule>


  <!-- ================================================= -->
  <!-- BRUTE FORCE SQLI -->
  <!-- ================================================= -->

  <rule id="100022" level="15" frequency="3" timeframe="300">
    <if_matched_sid>100010</if_matched_sid>
    <same_field>transaction.client_ip</same_field>
    <description>Multiple SQL Injection attempts from same IP</description>
  </rule>


  <!-- ================================================= -->
  <!-- WEB SHELL UPLOAD -->
  <!-- ================================================= -->

  <rule id="100100" level="12">
    <if_group>syscheck</if_group>
    <regex>\.php$|\.jsp$|\.asp$|\.aspx$</regex>
    <description>Webshell file uploaded</description>
  </rule>


  <!-- ================================================= -->
  <!-- WEB SHELL COMMAND EXEC -->
  <!-- ================================================= -->

  <rule id="100101" level="13">
    <if_sid>100100</if_sid>
    <regex>cmd=|exec|system\(|passthru</regex>
    <description>Possible webshell command execution</description>
  </rule>


</group>
